<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IPL Match Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-image: url("{{ url_for('static', filename='bg image.png') }}");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        animation: backgroundMove 30s infinite linear;
      }

      @keyframes backgroundMove {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .neutral-option {
        color: gray;
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center">
    <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-2xl max-w-4xl w-full">
      <h1 class="text-3xl font-bold text-center mb-6">IPL Match Predictor</h1>

      <!-- Team Selection -->
      <div class="flex justify-between items-center mb-6">
        <!-- Team 1 -->
        <div class="flex flex-col items-center">
          <img id="team1-img" src="" alt="Team 1" class="w-24 h-24 rounded-full border-4 border-blue-500 mb-2" />
          <select id="team1" class="rounded p-2" onchange="onTeamChange()">
            <option value="">Select Team 1</option>
          </select>
        </div>

        <span class="text-lg font-bold">VS</span>

        <!-- Team 2 -->
        <div class="flex flex-col items-center">
          <img id="team2-img" src="" alt="Team 2" class="w-24 h-24 rounded-full border-4 border-red-500 mb-2" />
          <select id="team2" class="rounded p-2" onchange="onTeamChange()">
            <option value="">Select Team 2</option>
          </select>
        </div>
      </div>

      <!-- Venue Selection -->
      <div class="mb-6 text-center">
        <label class="block mb-1 font-semibold">Select Venue</label>
        <select id="venue" class="rounded p-2 w-full">
          <option value="">Select Venue</option>
        </select>
      </div>

      <!-- Toss Section -->
      <div class="flex justify-around items-center mb-6">
        <div class="flex flex-col items-center">
          <label class="mb-1 font-semibold">Toss Winner</label>
          <select id="toss-winner" class="rounded p-2">
            <option value="">Select Toss Winner</option>
          </select>
        </div>

        <div class="flex flex-col items-center">
          <label class="mb-1 font-semibold">Toss Decision</label>
          <select id="toss-decision" class="rounded p-2">
            <option value="">Select Decision</option>
            <option value="bat">Bat</option>
            <option value="field">Field</option>
          </select>
        </div>
      </div>

      <!-- Submit -->
      <div class="text-center">
        <button onclick="submitPrediction()" class="bg-indigo-600 text-white px-6 py-2 rounded-full font-semibold hover:bg-indigo-700">
          Predict Winner
        </button>
        <div id="result" class="mt-4 text-xl font-bold"></div>
      </div>
    </div>

    <script>
      const teamData = {
        "Mumbai Indians": "https://assets.iplt20.com/ipl/MI/Logos/Logooutline/MIoutline.png",
        "Chennai Super Kings": "https://assets.iplt20.com/ipl/CSK/logos/Logooutline/CSKoutline.png",
        "Delhi Capitals": "https://assets.iplt20.com/ipl/DC/Logos/LogoOutline/DCoutline.png",
        "Kolkata Knight Riders": "https://assets.iplt20.com/ipl/KKR/Logos/Logooutline/KKRoutline.png",
        "Punjab Kings": "https://assets.iplt20.com/ipl/PBKS/Logos/Logooutline/PBKSoutline.png",
        "Rajasthan Royals": "https://assets.iplt20.com/ipl/RR/Logos/Logooutline/RRoutline.png",
        "Royal Challengers Bengaluru": "https://assets.iplt20.com/ipl/RCB/Logos/Logooutline/RCBoutline.png",
        "Sunrisers Hyderabad": "https://assets.iplt20.com/ipl/SRH/Logos/Logooutline/SRHoutline.png",
        "Lucknow Super Giants": "https://assets.iplt20.com/ipl/LSG/Logos/Logooutline/LSGoutline.png",
        "Gujarat Titans": "https://assets.iplt20.com/ipl/GT/Logos/Logooutline/GToutline.png"
      };

      const teamVenues = {};

      // Load team venue data
      fetch("/get_team_venues")
        .then(res => res.json())
        .then(data => {
          Object.assign(teamVenues, data);
        });

      // Populate team dropdowns
      function populateTeams() {
        const ids = ["team1", "team2"];
        ids.forEach(id => {
          const select = document.getElementById(id);
          select.innerHTML = '<option value="">Select Team</option>';
          Object.keys(teamData).forEach(team => {
            const option = document.createElement("option");
            option.value = team;
            option.textContent = team;
            select.appendChild(option);
          });
        });
      }

      function updateImages() {
        ["team1", "team2"].forEach(teamId => {
          const team = document.getElementById(teamId).value;
          document.getElementById(`${teamId}-img`).src = teamData[team] || "";
        });
      }

      function updateTossOptions() {
        const team1 = document.getElementById("team1").value;
        const team2 = document.getElementById("team2").value;
        const toss = document.getElementById("toss-winner");
        toss.innerHTML = '<option value="">Select Toss Winner</option>';
        if (team1) toss.innerHTML += `<option value="${team1}">${team1}</option>`;
        if (team2 && team2 !== team1) toss.innerHTML += `<option value="${team2}">${team2}</option>`;
      }

      function updateVenueOptions() {
  const venueSelect = document.getElementById("venue");
  const team1 = document.getElementById("team1").value;
  const team2 = document.getElementById("team2").value;

  venueSelect.innerHTML = '<option value="">Select Venue</option>';

  if (team1 && team2 && teamVenues[team1] && teamVenues[team2]) {
    const allVenues = [...new Set([...teamVenues[team1], ...teamVenues[team2]])]; // Union of venues
    allVenues.forEach(venue => {
      const option = document.createElement("option");
      option.value = venue;
      option.text = venue;
      venueSelect.appendChild(option);
    });
  }
}


      function submitPrediction() {
        const team1 = document.getElementById("team1").value;
        const team2 = document.getElementById("team2").value;
        const tossWinner = document.getElementById("toss-winner").value;
        const tossDecision = document.getElementById("toss-decision").value;
        const venue = document.getElementById("venue").value;
        const resultDiv = document.getElementById("result");

        if (!team1 || !team2 || !tossWinner || !tossDecision || !venue) {
          resultDiv.innerText = "‚ö†Ô∏è Please fill all selections.";
          return;
        }

        if (team1 === team2) {
          resultDiv.innerText = "‚ùå Team 1 and Team 2 cannot be the same.";
          return;
        }

        fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ team1, team2, toss_winner: tossWinner, toss_decision: tossDecision, venue })
        })
        .then(res => res.json())
        .then(data => {
          resultDiv.innerText = `üèÜ Predicted Winner: ${data.winner}`;
        })
        .catch(() => {
          resultDiv.innerText = "‚ùå Prediction failed. Try again.";
        });
      }

      function onTeamChange() {
        updateImages();
        updateTossOptions();
        updateVenueOptions();
      }

      // Initial setup
      populateTeams();
    </script>
  </body>
</html>
